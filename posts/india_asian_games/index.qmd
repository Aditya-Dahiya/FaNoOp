---
title: "India at Asian Games - Over the Years"
subtitle: "Analyzing medals data on how India has performed over the years"
author: "Aditya Dahiya"
date: "2023-10-06"
categories: [analysis]
image: "logo.png"
editor_options: 
  chunk_output_type: console
execute: 
  echo: false
  error: false
  message: false
  warning: false
filters:
  - social-share
share:
  permalink: "https://aditya-dahiya.github.io/FaNoOp/posts/india_asian_games/"
  description: "India at Asian Games - medals - over the years"
  twitter: true
  facebook: true
  linkedin: true
  email: true
---

```{r}
#| label: setup

library(tidyverse)
library(rvest)
library(gt)
library(gtExtras)
library(janitor)
```

Retrieve data on Asian Games - total medals in each Asiad edition and total medals by all countries historically from a Wikipedia [article](https://en.wikipedia.org/wiki/All-time_Asian_Games_medal_table). Using data from [India at Asian Games](https://en.wikipedia.org/wiki/India_at_the_Asian_Games) from Wikipedia.

```{r}
#| label: Dont-eval-Harvesting-Asian-Games-Overall-Data
#| eval: false

# Capture url, html and rvest 
url1 <- "https://en.wikipedia.org/wiki/All-time_Asian_Games_medal_table"
html1 <- read_html(url1)

list1 <- html1 |>
  html_nodes("table") |>
  html_table()

# Total number of medals, gold, silver and bronze in each edition of Asiad
total_medals_hist <- list1[[1]] |>
  filter(Number != "Total") |>
  mutate_at(vars(-Number), parse_number) |>
  clean_names() |>
  rename(asiad = number) |>
  separate_wider_delim(cols = asiad,
                       delim = " -",
                       names = c(NA, "asiad")) |>
  mutate(asiad = parse_number(asiad))

# Correct the year for 2022 Asiad to 2023
total_medals_hist[19, "year"] <- 2023

# Total cumulative medals by every country from start upto 2018 Asiad
ctry_tot_medals_hist <- list1[[5]] |>
  mutate(
    country = str_replace_all(Nation, "\\s*\\(.*\\)", ""),
    code = str_extract(Nation, "\\(([^)]*)\\)"),
    code = str_sub(code, 2, nchar(code) - 1)
  ) |>
  select(-Nation) |>
  relocate(country, .before = Gold) |>
  clean_names() |>
  filter(!str_detect(rank, "Total")) |>
  mutate(rank = as.numeric(rank))

# 2022 Asian Games Medal Table
url3 <- "https://en.wikipedia.org/wiki/2022_Asian_Games_medal_table"
html3 <- read_html(url3)
list3 <- html3 |>
  html_nodes("table") |>
  html_table()

medals_2022 <- list3[[2]] |>
  clean_names() |>
  filter(!str_detect(rank, "Total")) |>
  mutate(
    rank = as.numeric(rank),
    nation = str_replace_all(nation, "[*+/]", "")
  )

total_medals_hist[19, "gold"] <- medals_2022 |> pull(gold) |> sum()
total_medals_hist[19, "silver"] <- medals_2022 |> pull(silver) |> sum()
total_medals_hist[19, "bronze"] <- medals_2022 |> pull(bronze) |> sum()
total_medals_hist[19, "total"] <- medals_2022 |> pull(total) |> sum()

rm(list1, list3, html1, html3, url1, url3)

write_csv(ctry_tot_medals_hist, "posts/india_asian_games/ctry_tot_medals_hist.csv")
write_csv(medals_2022, "posts/india_asian_games/medals_2022.csv")
write_csv(total_medals_hist, "posts/india_asian_games/total_medals_hist.csv")
```

Reading in the data

```{r}
#| label: reading-in-the-data-harvested

ctry_tot_medals_hist <- read_csv("https://raw.githubusercontent.com/Aditya-Dahiya/FaNoOp/main/posts/india_asian_games/ctry_tot_medals_hist.csv")

medals_2022 <- read_csv("https://raw.githubusercontent.com/Aditya-Dahiya/FaNoOp/main/posts/india_asian_games/medals_2022.csv")

total_medals_hist <- read_csv("https://raw.githubusercontent.com/Aditya-Dahiya/FaNoOp/main/posts/india_asian_games/total_medals_hist.csv")

ind_med_hist <- read_csv("https://raw.githubusercontent.com/Aditya-Dahiya/FaNoOp/main/posts/india_asian_games/ind_med_hist.csv")

ind_tot_med_sport <- read_csv("https://raw.githubusercontent.com/Aditya-Dahiya/FaNoOp/main/posts/india_asian_games/ind_tot_med_sport.csv")
```

```{r}
#| label: Dont-eval-Harvesting-India-Data-at-Asian-Games
#| eval: false


url2 <- "https://en.wikipedia.org/wiki/India_at_the_Asian_Games"
html2 <- read_html(url2)

list2 <- html2 |>
  html_nodes("table") |>
  html_table()

ind_med_hist <- list2[[2]] |>
  clean_names() |>
  separate_wider_delim(cols = games,
                       delim = " ",
                       too_many = "merge",
                       too_few = "align_end",
                       names = c("year", "host_city")) |>
  filter(host_city != "Total") |>
  mutate(across(c(year, rank, gold, silver, bronze, total),
                parse_number),
         host_city = str_replace_all(host_city, "\\[.*?\\]", "")) |>
  print(n = Inf)

ind_tot_med_sport <- list2[[3]] |>
  clean_names() |>
  select(-rank) |>
  filter(sport != "Total")

rm(url2, html2, list2)

write_csv(ind_med_hist, "posts/india_asian_games/ind_med_hist.csv")
write_csv(ind_tot_med_sport, "posts/india_asian_games/ind_tot_med_sport.csv")
```

Harvesting other countries and historical data from [here](https://bestsports.com.br/db/evnmedpag.php?evn=2336&lang=2), i.e., *bestsports.com*

```{r}
#| label: one-tim-code-only-harvest-all-countries-historical-data-bestsports.com
#| eval: false

url4 <- "https://bestsports.com.br/db/evnmedpag.php?evn=2336&lang=2"
html4 <- read_html(url4)
list4 <- html4 |>
  html_nodes("table") |>
  html_table()

medals_2018 <- list4[[2]] |>
  clean_names() |>
  filter(!is.na(gold)) |>
  select(-country_2) |>
  rename(rank = country,
         nation = country_3) |>
  mutate(year = 2018) |>
  relocate(year, .before = rank)

read_medals <- function(website, year_games){
  html_temp <- read_html(website)

  list_temp <- html_temp |>
  html_nodes("table") |>
  html_table()

  return(
    list_temp[[2]] |>
    clean_names() |>
    filter(!is.na(gold)) |>
    select(-country_2) |>
    rename(rank = country,
           nation = country_3) |>
    mutate(year = year_games) |>
    relocate(year, .before = rank)
  ) 
}

medals_2014 <- read_medals("https://bestsports.com.br/db/evnmedpag.php?evn=2002&lang=2", 2014)

medals_2010 <- read_medals("https://bestsports.com.br/db/evnmedpag.php?evn=858&lang=2", 2010)

medals_2006 <- read_medals("https://bestsports.com.br/db/evnmedpag.php?evn=508&lang=2", 2006)

medals_2002 <- read_medals("https://bestsports.com.br/db/evnmedpag.php?evn=615&lang=2", 2002)

medals_1998 <- read_medals("https://bestsports.com.br/db/evnmedpag.php?evn=857&lang=2", 1998)

medals_1994 <- read_medals("https://bestsports.com.br/db/evnmedpag.php?evn=859&lang=2", 1994)

medals_1990 <- read_medals("https://bestsports.com.br/db/evnmedpag.php?evn=860&lang=2", 1990)

medals_1986 <- read_medals("https://bestsports.com.br/db/evnmedpag.php?evn=861&lang=2", 1986)

medals_1982 <- read_medals("https://bestsports.com.br/db/evnmedpag.php?evn=862&lang=2", 1982)

medals_1978 <- read_medals("https://bestsports.com.br/db/evnmedpag.php?evn=863&lang=2", 1978)

medals_1974 <- read_medals("https://bestsports.com.br/db/evnmedpag.php?evn=864&lang=2", 1974)

medals_1970 <- read_medals("https://bestsports.com.br/db/evnmedpag.php?evn=865&lang=2", 1970)

medals_1966 <- read_medals("https://bestsports.com.br/db/evnmedpag.php?evn=866&lang=2", 1966)
  
medals_1962 <- read_medals("https://bestsports.com.br/db/evnmedpag.php?evn=867&lang=2", 1962) |>
  mutate(rank = replace_na(rank, 13))

medals_1958 <- read_medals("https://bestsports.com.br/db/evnmedpag.php?evn=868&lang=2", 1958)

medals_1954 <- read_medals("https://bestsports.com.br/db/evnmedpag.php?evn=869&lang=2", 1954)

medals_1951 <- read_medals("https://bestsports.com.br/db/evnpag.php?evn=870&lang=2", 1951)

medals_all_years <- bind_rows(medals_1951,
          medals_1954,
          medals_1958,
          medals_1962,
          medals_1966,
          medals_1970,
          medals_1974,
          medals_1978,
          medals_1982,
          medals_1986,
          medals_1990,
          medals_1994,
          medals_1998,
          medals_2002,
          medals_2006,
          medals_2010,
          medals_2014,
          medals_2018)
write_csv(medals_all_years, "posts/india_asian_games/medals_all_years.csv")
```

```{r}
#| label: read-all-countries-medals-all-years

# Creating a data-frame of all medals over years by all countries

medals_all_years <- read_csv("https://raw.githubusercontent.com/Aditya-Dahiya/FaNoOp/main/posts/india_asian_games/medals_all_years.csv") |>
  bind_rows(medals_2022 |> mutate(year = 2023))
```

**Analysis**

```{r}
#| label: create-a-df1-for-india-ranks-etc.

df1 <- ind_med_hist |>
  left_join(total_medals_hist,
            by = join_by(year),
            suffix = c("_ind", "_all")) |>
  filter(year < 2024)

lab_col = c("Hosted by India", "Hosted by other nations")
names(lab_col) = c(TRUE, FALSE)
```

```{r}
#| label: fig-ranks-over-years
#| fig-cap: "India's rank in Medal Tally at Asian Games over the years"

df1 |>
  mutate(hosted_india = (host_nations == "India")) |>
  ggplot(aes(x = year, y = rank,
             label = rank)) +
  geom_point(aes(col = hosted_india,
                 size = hosted_india)) +
  geom_line(lty = 2) +
  geom_text(hjust = 1, vjust = -1) +
  theme_minimal() +
  scale_y_reverse(breaks = seq(11, 1, by = -2),
                  limits = c(11, 1)) +
  scale_x_continuous(breaks = df1$year) +
  # scale_size_discrete(labels = labeller(lab_col)) +
  # scale_color_discrete(labels = labeller(lab_col)) +
  labs(x = NULL, y = "Rank in Medals' Tally",
       title = "India's rank fell over the decades",
       subtitle = "But, 2023's performance is a marked improvement: Best ever since 1962!", col = NULL, size = NULL) +
  theme(panel.grid = element_blank(),
        legend.position = "bottom")
```

India's medal-haul has risen over the years

```{r}
ind_med_hist |>
  ggplot(aes(x = year,
             y = total,
             label = total,
             fill = (host_nations == "India"))) +
  geom_bar(stat = "identity") +
  scale_x_continuous(breaks = ind_med_hist$year)
```

But, so has the total number of medals up for grabs in each Asiad over the years: --

```{r}
total_medals_hist |>
  ggplot() +
  geom_bar(mapping = aes(x = year,
                         y = total),
           stat = "identity") +
  scale_x_continuous(breaks = total_medals_hist$year)
```

So, to make a meaningful comparison, lets see the percentage of total medals on offer won by India over the years

```{r}
df1 |>
  mutate(
    hosted_india = (host_nations == "India"),
    prop_medals = total_ind/total_all,
    prop_gold = gold_ind/gold_all,
    prop_silver = silver_ind/silver_all,
    prop_bronze = bronze_ind/bronze_all
  ) |>
  ggplot(aes(x = year)) +
  geom_line(aes(y = prop_gold),
            col = "gold",
            lty = 2) +
  geom_point(aes(y = prop_gold),
             col = "gold") +
  geom_line(aes(y = prop_silver),
            col = "grey",
            lty = 2) +
  geom_point(aes(y = prop_silver),
             col = "grey") +
  geom_line(aes(y = prop_bronze),
            col = "brown",
            lty = 2) +
  geom_point(aes(y = prop_bronze),
             col = "brown") +
  geom_line(aes(y = prop_medals),
            col = "black",
            lty = 2,
            lwd = 1) +
  geom_point(aes(y = prop_medals),
             col = "black",
             size = 3) +
  scale_x_continuous(breaks = df1$year) +
  theme_classic() +
  scale_y_continuous(limits = c(0, 0.365))
```

Interactive Graph of proportion of medals won by all countries over years

```{r}
plotly::ggplotly(
  
medals_all_years |>
  group_by(year) |>
  mutate(all_total = sum(total),
         all_gold = sum(gold),
         all_silver = sum(silver),
         all_bronze = sum(bronze)) |>
  mutate(prop_total = total/all_total,
         prop_gold = gold/all_gold,
         prop_silver = silver/all_silver,
         prop_bronze = bronze/all_bronze,
         ctry_label = if_else(year == 2023,
                              nation,
                              NA),
         is_india = (nation == "India")
         ) |>
  filter(year > 1990) |>
  ungroup() |>
  rename(
    Year = year,
    Country = nation
  ) |>
  ggplot(aes(x = Year,
             y = prop_total,
             group = Country,
             col = is_india,
             alpha = is_india,
             text = paste("Medals: ", round(prop_total*100, 1), " %")
             )
         ) +
  geom_point() +
  geom_line() +
  scale_x_continuous(breaks = medals_all_years |>
                     distinct(year) |> pull(year)) +
  scale_y_continuous(labels = scales::percent) +
  scale_color_manual(values = c("#6d6d70", "#273de3")) +
  scale_linewidth_discrete(range = c(0.5, 1.2)) +
  theme_minimal() +
  theme(panel.grid = element_blank(),
        legend.position = "none") +
  labs(x = NULL, y = "Percentage of total medals won"),

tooltip = c("group", "text", "x")
)
```

A comparison chart for top 5 medal winning countries in Asian Games over the years: --

```{r}
com_countries = (ctry_tot_medals_hist |> pull(country))[1:5]

medals_all_years |>
  group_by(year) |>
  mutate(all_total = sum(total),
         all_gold = sum(gold),
         all_silver = sum(silver),
         all_bronze = sum(bronze)) |>
  filter(nation %in% com_countries) |>
  mutate(prop_total = total/all_total,
         prop_gold = gold/all_gold,
         prop_silver = silver/all_silver,
         prop_bronze = bronze/all_bronze,
         ctry_label = if_else(year == 2023,
                              nation,
                              NA),
         is_india = (nation == "India")
         ) |>
  ungroup() |>
  ggplot(aes(x = year,
             y = prop_total,
             col = nation,
             label = ctry_label)) +
  geom_line(aes(lwd = is_india), alpha = 0.7) +
  geom_point(size = 1.5, alpha = 0.5) +
  ggrepel::geom_label_repel() +
  scale_x_continuous(breaks = medals_all_years |>
                     distinct(year) |> pull(year)) +
  scale_y_continuous(labels = scales::percent) +
  scale_color_brewer(palette = "Set1") +
  scale_linewidth_discrete(range = c(0.5, 1.2)) +
  theme_minimal() +
  theme(panel.grid = element_blank(),
        legend.position = "none") +
  labs(x = NULL, y = "Percentage of total medals won")
```

**Pie chart for medals all over the years**

**Sports where India's all time medals have come from**

```{=html}
<iframe title="Share of sports in India's all-time medals at Asian Games" aria-label="Pie Chart" id="datawrapper-chart-qV2pZ" src="https://datawrapper.dwcdn.net/qV2pZ/1/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="572" data-external="1"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(a){if(void 0!==a.data["datawrapper-height"]){var e=document.querySelectorAll("iframe");for(var t in a.data["datawrapper-height"])for(var r=0;r<e.length;r++)if(e[r].contentWindow===a.source){var i=a.data["datawrapper-height"][t]+"px";e[r].style.height=i}}}))}();
</script>
```
**Sports from where India's Gold, Silver and Bronze Medals have come from: --**

Gold Medals

```{=html}
<iframe title="Share in India's Gold Medals" aria-label="Pie Chart" id="datawrapper-chart-MauTe" src="https://datawrapper.dwcdn.net/MauTe/1/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="500" data-external="1"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(a){if(void 0!==a.data["datawrapper-height"]){var e=document.querySelectorAll("iframe");for(var t in a.data["datawrapper-height"])for(var r=0;r<e.length;r++)if(e[r].contentWindow===a.source){var i=a.data["datawrapper-height"][t]+"px";e[r].style.height=i}}}))}();
</script>
```
Silver Medals

```{=html}
<iframe title="Share in India's Silver Medals" aria-label="Pie Chart" id="datawrapper-chart-AkGs2" src="https://datawrapper.dwcdn.net/AkGs2/2/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="500" data-external="1"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(a){if(void 0!==a.data["datawrapper-height"]){var e=document.querySelectorAll("iframe");for(var t in a.data["datawrapper-height"])for(var r=0;r<e.length;r++)if(e[r].contentWindow===a.source){var i=a.data["datawrapper-height"][t]+"px";e[r].style.height=i}}}))}();
</script>
```
Bronze Medals

```{=html}
<iframe title="Share in India's Bronze Medals" aria-label="Pie Chart" id="datawrapper-chart-Ve95F" src="https://datawrapper.dwcdn.net/Ve95F/1/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="500" data-external="1"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(a){if(void 0!==a.data["datawrapper-height"]){var e=document.querySelectorAll("iframe");for(var t in a.data["datawrapper-height"])for(var r=0;r<e.length;r++)if(e[r].contentWindow===a.source){var i=a.data["datawrapper-height"][t]+"px";e[r].style.height=i}}}))}();
</script>
```
```{r}
#| label: harvest-sport-wise-medals-india-2023
#| eval: false

# Capture url, html and rvest 
url5 <- "https://en.wikipedia.org/wiki/India_at_the_2022_Asian_Games"
html5 <- read_html(url5)

list5 <- html5 |>
  html_nodes("table") |>
  html_table()

list5[[3]] |>
  select(X1:X5) |>
  row_to_names(3) |>
  slice_head(n = 22) |>
  write_csv("posts/india_asian_games/temp4_dw.csv")
```

**Sports from where India's Total, Gold, Silver and Bronze Medals have come from in 2023 Asian Games: --**

Total Medals

```{=html}
<iframe title="India's medals at 2023 Asian Games" aria-label="Pie Chart" id="datawrapper-chart-yRR2O" src="https://datawrapper.dwcdn.net/yRR2O/1/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="572" data-external="1"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(a){if(void 0!==a.data["datawrapper-height"]){var e=document.querySelectorAll("iframe");for(var t in a.data["datawrapper-height"])for(var r=0;r<e.length;r++)if(e[r].contentWindow===a.source){var i=a.data["datawrapper-height"][t]+"px";e[r].style.height=i}}}))}();
</script>
```
Gold Medals

```{=html}
<iframe title="India's Gold Medals at 2023 Asian Games" aria-label="Pie Chart" id="datawrapper-chart-bxxwr" src="https://datawrapper.dwcdn.net/bxxwr/1/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="500" data-external="1"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(a){if(void 0!==a.data["datawrapper-height"]){var e=document.querySelectorAll("iframe");for(var t in a.data["datawrapper-height"])for(var r=0;r<e.length;r++)if(e[r].contentWindow===a.source){var i=a.data["datawrapper-height"][t]+"px";e[r].style.height=i}}}))}();
</script>
```
Silver Medals

```{=html}
<iframe title="India's Silver Medals at 2023 Asian Games" aria-label="Pie Chart" id="datawrapper-chart-1zCie" src="https://datawrapper.dwcdn.net/1zCie/1/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="500" data-external="1"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(a){if(void 0!==a.data["datawrapper-height"]){var e=document.querySelectorAll("iframe");for(var t in a.data["datawrapper-height"])for(var r=0;r<e.length;r++)if(e[r].contentWindow===a.source){var i=a.data["datawrapper-height"][t]+"px";e[r].style.height=i}}}))}();
</script>
```
Bronze Medals

```{=html}
<iframe title="India's Bronze Medals at 2023 Asian Games" aria-label="Pie Chart" id="datawrapper-chart-8KyJh" src="https://datawrapper.dwcdn.net/8KyJh/1/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="500" data-external="1"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(a){if(void 0!==a.data["datawrapper-height"]){var e=document.querySelectorAll("iframe");for(var t in a.data["datawrapper-height"])for(var r=0;r<e.length;r++)if(e[r].contentWindow===a.source){var i=a.data["datawrapper-height"][t]+"px";e[r].style.height=i}}}))}();
</script>
```
Share of gold medals in India's medal over the years

```{r}
ind_med_hist |>
  mutate(
    share_gold = round(100*gold/total, 1),
    year = if_else(year == 2022, 2023, year),
    hosted = (host_nations == "India")
  ) |>
  ggplot(aes(x = year,
             y = share_gold,
             label = paste0(share_gold, " %")
             )
         ) +
  ggrepel::geom_label_repel(aes(col = hosted)) +
  geom_point(aes(col = hosted)) +
  geom_line(lty = 2) +
  theme_minimal() +
  scale_x_continuous(breaks = year)
```
